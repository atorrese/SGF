@using NuGet.Protocol
@using SGF.Models
@using NPOI.SS.Formula.Functions
@model List<FlowPedido>

@{
    ViewData["Title"] = "Index";
}
<link rel="stylesheet" href="~/lib/filepond/filepond.min.css">
<link rel="stylesheet" href="~/lib/filepond-plugin-image-preview/filepond-plugin-image-preview.min.css">
<link rel="stylesheet" href="~/lib/filepond-plugin-image-edit/filepond-plugin-image-edit.min.css">
<link rel="stylesheet" href="~/lib/dropzone/dropzone.css">
<div class="container">
    <div class="container-fluid">
        <div class="card">
            <div class="card-title text-center">
                <h1>Listado de Pedidos Flow Compra</h1>
            </div>
            
            <div class="card-body rounded-3 border-dark">
                <a href="javascript:;" class="btn btn-success mb-2" id="btn-nuevo"><i class="bi bi-plus"></i> Nuevo</a>
                <table class="table table-hover table-striped dataTable table-responsive" role="grid">
                    <thead class="table-primary">
                    <tr>
                        <th class="text-center">N° Pedido</th>
                        <th class="text-center">Titulo</th>
                        <th class="text-center">Proveedor</th>
                        <th class="text-center">F Almacen</th>
                        <th class="text-center">F Disp</th>
                        <th class="text-center">Urgente</th>
                        <th class="text-center">Total</th>
                        <th class="text-center">Estado</th>
                        <th class="text-center"><i class="bi bi-gear-fill"></i></th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var pedido in @Model)
                    {
                        <tr>
                            <td class="text-center">
                                @pedido.NumeroPedido
                                <small>
                                    <span class="badge bg-info text-dark fst-normal">@pedido.Fecha.ToString("dd/MM/yyyy HH:mm:ss")</span>
                                </small>
                            </td>
                            <td class="text-center">@pedido.Titulo</td>
                            <td class="text-center">@pedido.Proveedor</td>
                            <td class="text-center">@pedido.FechaAlmacen.ToString("dd/MM/yyyy")</td>
                            <td class="text-center">@pedido.FechaDisponible.ToString("dd/MM/yyyy")</td>
                            <td class="text-center">
                                @if (@pedido.Urgente)
                                {
                                    <span class="badge bg-danger">SI</span>
                                }
                                else
                                {
                                    <span class="badge bg-dark">NO</span>
                                }
                            </td>
                            <td class="text-center">$@pedido.Total</td>
                            <td class="text-center">
                                @switch (@pedido.Estado)
                                {
                                    case 1:
                                        <span class="badge bg-black">Sin Enviar</span>
                                        break;
                                    case 2:
                                        <span class="badge bg-primary">Enviado</span>
                                        break;
                                    case 3:
                                        <small>
                                            <div class="align-items-start">
                                                <span class="avatar avatar-sm avatar-radius me-2">
                                                    <i class="bi bi-people-fill"></i> @pedido.CantidadAprobaciones/5
                                                </span><br>
                                                <span class="badge bg-secondary fw-bold" style="font-size:10px;">@pedido.TextoCantidadAprobaciones</span>
                                            </div>
                                        </small>
                                        <span class="badge bg-warning">Pendiente</span>
                                        break;
                                    case 4:
                                        <span class="badge bg-success">Aprobado</span>
                                        break;
                                    case 5:
                                        <span class="badge bg-danger">Rechazado</span>
                                        break;
                                }
                            </td>
                            <td class="text-center">
                                <div class="btn-group">
                                    <a type="button" class="btn-icon btn btn-ghost btn-sm rounded-circle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        @if (@pedido.Estado==1)
                                        {
                                            <li>
                                                <a class="dropdown-item btn-edit" href="javascript:;">
                                                    <i class="bi bi-pencil-square"></i> Editar
                                                </a>
                                            </li>
                                            <li>
                                                <a class="dropdown-item btn-enviar" href="javascript:;" data-json='@pedido.ToJson()'>
                                                    <i class="bi bi-send"></i> Enviar 
                                                </a>
                                            </li>
                                            <li>
                                                <a class="dropdown-item btn-config-aprobadores" href="javascript:;" data-json='{"numero_aprobados":@pedido.CantidadAprobaciones, "total_aprueban":5}'>
                                                    <i class="bi bi-people"></i> Configuración de Aprobadores
                                                </a>
                                            </li>
                                        }
                                        @if (pedido.Estado>1)
                                        {
                                            <li>
                                                <a class="dropdown-item btn-aprobadores" href="javascript:;" data-json='{"numero_aprobados":@pedido.CantidadAprobaciones, "total_aprueban":5}'>
                                                    <i class="bi bi-people"></i> Historial de estados
                                                </a>
                                            </li> 
                                        }
                                        @if (pedido.Estado ==4)
                                        {
                                            <li>
                                                <a class="dropdown-item btn-aprobadores btn-generar-oc" href="javascript:;" >
                                                    <i class="bi bi-repeat"></i> Generar OC en Gp
                                                </a>
                                            </li> 
                                        }
                                        <li>
                                            <a class="dropdown-item btn-detalle-pedido" href="javascript:;">
                                                <i class="bi bi-eye"></i> Detalle
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalFormulario" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalFormularioLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalFormularioLabel">
                    Pedido
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="#" class="form-horizontal">
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Nro pedido</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-upc"></i></span>
                                        <input type="text" value="PE0000011" readonly="readonly" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Fecha Almacén</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-calendar-fill"></i></span>
                                        <input type="date" aria-label="First name" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Titulo</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-alphabet"></i></span>
                                        <input type="text" value="" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Fecha Disponible</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-calendar"></i></span>
                                        <input type="date" aria-label="First name" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Proveedor</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-person-lines-fill"></i></span>
                                        <select name="proveedor" id="id_proveedor" class="form-select form-control">
                                            <option value="0">Seleccione proveedor</option>
                                            <option value="1">Biomerux</option>
                                            <option value="2">Siemens</option>
                                            <option value="2">Mindray</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Urgente</label>
                                <div class="col-md-8 mt-2">
                                    <div class="input-group">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Via</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-cursor-fill"></i></span>
                                        <select name="via" id="id_via" class="form-select form-control">
                                            <option value="0">Seleccione Via</option>
                                            <option value="1">AEREA</option>
                                            <option value="2">MARITIMA</option>
                                            <option value="2">TERRESTRE</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Es Equipo</label>
                                <div class="col-md-8 mt-2">
                                    <div class="input-group">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Landed</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-alphabet"></i></span>
                                        <input type="text" aria-label="First name" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Archivo Sustento</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-file-earmark-font-fill"></i></span>
                                        <input type="file" aria-label="First name" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="row">
                                <label class="col-md-4 form-label mt-2">Imagen Sustento</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-file-earmark-image-fill"></i></span>
                                        <input type="file" aria-label="First name" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12 mb-2">
                            <div class="row">
                                <label class="col-md-2 form-label mt-2">Observaciones</label>
                                <div class="col-md-10">
                                    <div class="input-group">
                                        <span class="input-group-text fw-bold"><i class="bi bi-alphabet"></i></span>
                                        <textarea name="" id="" cols="30" rows="2" class="form-control">
                            
                                        </textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6 mb-2">
                            <div class="btn-list btn-list-icon">
                                <button type="button" class="btn btn-outline-primary ms-1" id="btn-show-modal-upload">
                                    <i class="bi bi-file-earmark-arrow-up-fill me-2"></i> Cargar Items
                                </button>
                                <a class="btn btn-link mx-2"  href="javascript:;"><i class="fa fa-file-excel-o"></i> Plantilla pedido items</a>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-borderless">
                                <thead class="table-primary">
                                <tr>
                                    <th>Planing</th>
                                    <th>Código Item</th>
                                    <th>Código Prov.</th>
                                    <th>Descripción</th>
                                    <th>Temperatura</th>
                                    <th>Reg.San.</th>
                                    <th>F. Venc.</th>
                                    <th>Id A. Negocio</th>
                                    <th>Origen</th>
                                    <th>Planta</th>
                                    <th>Via</th>
                                    <th>Marca</th>
                                    <th>Linea</th>
                                    <th>Familia</th>
                                    <th>Tipo</th>
                                    <th>Cantidad</th>
                                    <th>Precio</th>
                                    <th>Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>PLAN 1</td>
                                    <td>CDOE1</td>
                                    <td>CODT3</td>
                                    <td>REACTIVO</td>
                                    <td>73C°</td>
                                    <td>JD0E345-2024</td>
                                    <td>12/04/2026</td>
                                    <td>12 BIOCIENCIA</td>
                                    <td>ALEMANIA</td>
                                    <td>--</td>
                                    <td>--</td>
                                    <td>--</td>
                                    <td></td>
                                    <td></td>
                                    <td>--</td>
                                    <td>--</td>
                                    <td>--</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary"><i class="bi bi-floppy"></i> Guardar</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cancelar</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="modalHistorialEstados" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalHistorialEstadosLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalHistorialEstadosLabel">Historial de estados Pedido Flow </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table table-striped table-hover">
                    <thead class="table-info">
                    <tr>
                        <th>#</th>
                        <th>Area</th>
                        <th>Fecha</th>
                        <th>Usuario</th>
                        <th>Estado</th>
                    </tr>
                    </thead>
                    <tbody id="id_detalle">
              
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cerrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalImportFile" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalImportFileLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header pt-1 pb-1">
                <h5 class="modal-title" id="modalImportFileLabel">Importar archivo de items</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" id="formImportFile">
                    <div class=" card-body p-0">
                        <div class="form-group mb-0">
                            <input type="file" class="my-pond" name="fileExcel" accept=".xlsx,.XLSX" >
                        </div>
                        <div class="form-group mb-0 detail-records-resumen">
                            <ul class="list-group list-group-flush">
                            </ul>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer pt-1 pb-1">
                <button type="button" class="btn btn-success btn-sm" id="btn-upload-data"  disabled>
                    <i class="fe fe-upload me-2"></i> Importar items
                </button>
                <button type="button" class="btn btn-secondary btn-sm"  data-bs-dismiss="modal">
                    <i class="fe fe-x me-2"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalConfiguracionaprobadores" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalConfiguracionaprobadoresLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalConfiguracionaprobadoresLabel">Configurar aprobadores Pedidos flow</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <div class="row">
                            <label class="col-md-4 form-label mt-2">Proveedor</label>
                            <div class="col-md-8">
                                <div class="input-group">
                                    <span class="input-group-text fw-bold"><i class="bi bi-person-lines-fill"></i></span>
                                    <select name="proveedor" id="id_proveedor" class="form-select form-control">
                                        <option value="0">Seleccione proveedor</option>
                                        <option value="1">atorres -- A Gte Gral</option>
                                        <option value="2">ajurado -- A Gte Linea</option>
                                        <option value="3">ecajas -- A. Gte Undidad</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table table-striped table-hover">
                    <thead class="table-info">
                    <tr>
                        <th>#</th>
                        <th>Area</th>
                        <th>Usuario</th>
                        <th>Cargo</th>
                        <th>Orden Aprobación</th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Comercial</td>
                            <td>spolanco</td>
                            <td>Gerente Linea</td>
                            <td>1</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>Comercial</td>
                            <td>eespinoza</td>
                            <td>Gerente Venta</td>
                            <td>2</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Gerencia</td>
                            <td>saguirre</td>
                            <td>Gerente General</td>
                            <td>3</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>Directivo</td>
                            <td>saguirre</td>
                            <td>Presidente</td>
                            <td>4</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cerrar</button>
            </div>
        </div>
    </div>
</div>
@section Scripts{
    <!-- Filepond JS -->
    <script src="~/lib/filepond/filepond.min.js"></script>
    <script src="~/lib/filepond-plugin-image-preview/filepond-plugin-image-preview.min.js"></script>
    <script src="~/lib/filepond-plugin-image-exif-orientation/filepond-plugin-image-exif-orientation.min.js"></script>
    <script src="~/lib/filepond-plugin-file-validate-size/filepond-plugin-file-validate-size.min.js"></script>
    <script src="~/lib/filepond-plugin-file-encode/filepond-plugin-file-encode.min.js"></script>
    <script src="~/lib/filepond-plugin-image-edit/filepond-plugin-image-edit.min.js"></script>
    <script src="~/lib/filepond-plugin-file-validate-type/filepond-plugin-file-validate-type.min.js"></script>
    <script src="~/lib/filepond-plugin-file-validate-type/filepond-plugin-file-validate-type.min.js"></script>
    <script src="~/lib/filepond-plugin-image-crop/filepond-plugin-image-crop.min.js"></script>
    <script src="~/lib/filepond-plugin-image-resize/filepond-plugin-image-resize.min.js"></script>
    <script src="~/lib/filepond-plugin-image-transform/filepond-plugin-image-transform.min.js"></script>
    <script src="~/lib/jquery-filepond/filepond.jquery.js"></script>
    <script>
    
    function mensaje_confirmacion(titulo, contenido, respuestaOk, respuestaNo){
              Swal.fire({
                  title: titulo,
                  html: contenido,
                  icon: 'success',
                  width:'auto',
                 // showCancelButton: true,
                 allowOutsideClick:false,
                 confirmButtonColor: '#3085d6',
                 cancelButtonColor: '#d33',
                 confirmButtonText: 'Ok',
                 cancelButtonText: 'No',
                 isDismissed: false
              }).then((result) => {
                  if (result.isConfirmed) {
                      respuestaOk(result)
                  }else{
                      respuestaNo(result)
                  }
              });
        }
    function mensaje_confirmacion_ajax(url,title, contenido, parametros, callbackDone, callbackFail) {
         Swal.fire({
             title: title,
             html: contenido,
             icon: 'warning',
             showCancelButton: true,
             confirmButtonColor: '#3085d6',
             cancelButtonColor: '#d33',
             confirmButtonText: 'Si',
             cancelButtonText: 'No',
             isDismissed: false
         }).then((result) => {
             if (result.isConfirmed) {
                 $.post(url, parametros).done((response) => {
                     callbackDone(response)
                 }).fail((error) => {
                    callbackFail(error)
                 });
             }
         });
    }
    
    
    
    
        function generarFechaAleatoria() {
            // Generar valores aleatorios para año, mes, día, hora, minuto, segundo y milisegundo
            var año = Math.floor(Math.random() * (2100 - 1900)) + 1900; // Entre 1900 y 2099
            var mes = Math.floor(Math.random() * 12) + 1; // Entre 1 y 12
            var dia = Math.floor(Math.random() * 31) + 1; // Entre 1 y 31 (ignorando el control de días en meses)
            var hora = Math.floor(Math.random() * 24); // Entre 0 y 23
            var minuto = Math.floor(Math.random() * 60); // Entre 0 y 59
            var segundo = Math.floor(Math.random() * 60); // Entre 0 y 59
            var milisegundo = Math.floor(Math.random() * 1000); // Entre 0 y 999
        
            // Crear una nueva fecha con los valores aleatorios
            var fecha = new Date(año, mes - 1, dia, hora, minuto, segundo, milisegundo); // Meses en JavaScript son de 0 a 11
        
            return fecha;
        }
        
        $("#btn-nuevo").click(function() {
            $("#modalFormulario .modal-header .modal-title").text("Nuevo Pedido")
            $("#modalFormulario").modal("show");
        }); 
    
        $(".btn-edit").click(function() {
            $("#modalFormulario .modal-header .modal-title").text("Editar Pedido")
            $("#modalFormulario").modal("show");
        });
        
        $('.btn-enviar').click(function() {
            let data = $(this).data('json');
            let contenido = `¿Estas seguro de enviar el pedido?<br><span class="badge bg-success">${data.numero_pedido}</span>`;
            mensaje_confirmacion_ajax('', 'Información!',contenido, {} ,function(response) {
                mensaje_confirmacion('Información!', `Se cambio el estado del pedido ${data.numero_pedido}`, 
                    function(result) {
                      location.reload();
                    },
                    function(result) {
                         Swal.fire(
                             'Información!',
                            `Falla al cambiar el estado del pedido`,
                             'error'
                         );
                    }
                )
            },
            function(response) {
                Swal.fire(
                     'Información!',
                    'Error en la ejecución del ajax',
                     'error'
                 );
            }
            )
        });
        $('.btn-config-aprobadores').click(function (){
            $('#modalConfiguracionaprobadores').modal('show');
        });
        
        $('.btn-generar-oc').click(function() {
            let data = $(this).data('json');
            let contenido = `¿Estas seguro de Generar OC del pedido?<br><span class="badge bg-success">${data.numero_pedido}</span>`;
            mensaje_confirmacion_ajax('', 'Información!',contenido, {} ,function(response) {
                mensaje_confirmacion('Información!', `Se genero el estado del pedido ${data.numero_pedido}`, 
                    function(result) {
                      location.reload();
                    },
                    function(result) {
                         Swal.fire(
                             'Información!',
                            `Falla al generar la OC del pedido`,
                             'error'
                         );
                    }
                )
            },
            function(response) {
                Swal.fire(
                     'Información!',
                    'Error en la ejecución del ajax',
                     'error'
                 );
            }
            )
        });
        $('.btn-detalle-pedido').click(function() {
          $("#modalFormulario .modal-header .modal-title").text("Detalle del Pedido")
          $("#modalFormulario").modal("show");
        });
        
        $('.btn-aprobadores').click(function() {
          let data = $(this).data('json');
          let aprobadores = ["A.Logistica", "A.Gte Linea", "A.Gte Unidad", "A.Gte Gral", "A.Directorio" ];
          $('#id_detalle').html('');
          for(let i = 0; i < data.total_aprueban; i++) {
           $('#id_detalle').append(
                $("<tr>").append(
                    $("<td>").text(i+1),
                    $("<td>").text(aprobadores[i]),
                    $("<td>").text(generarFechaAleatoria().toLocaleString()),
                    $("<td>").text('atorres'),
                    $("<td>").html(`<span class="badge ${i<data.numero_aprobados? 'bg-success' : 'bg-warning'}">${i<data.numero_aprobados? 'Aprobado' : 'Pendiente'}</span>`),
                    
                )
           )
          }
          $('#modalHistorialEstados').modal('show')
        });
        
                   const myfilepond = $('.my-pond').filepond({
                         labelIdle: 'Arrastrar y soltar archivos o <span class="filepond--label-action"> Examinar </span>',
                         labelFileProcessing: 'Procesando...',
                         labelFileProcessingComplete: 'Procesamiento completado',
                         labelFileProcessingAborted: 'Procesamiento abortado',
                         labelFileProcessingError: 'Error al procesar el archivo',
                         labelFileProcessingRevertError: 'Error al revertir el procesamiento del archivo',
                         labelFileRemoveError: 'Error al eliminar el archivo',
                         labelTapToCancel: 'Toca para cancelar',
                         labelTapToRetry: 'Toca para intentar nuevamente',
                         labelTapToUndo: 'Toca para deshacer',
                         labelButtonRemoveItem: 'Eliminar',
                         labelButtonAbortItemLoad: 'Cancelar',
                         labelButtonRetryItemLoad: 'Reintentar',
                         labelButtonAbortItemProcessing: 'Cancelar',
                         labelButtonUndoItemProcessing: 'Deshacer',
                         labelButtonRetryItemProcessing: 'Reintentar',
                         labelButtonProcessItem: 'Subir',
                         labelMaxFileSizeExceeded: 'El archivo es demasiado grande',
                         labelMaxFileSize: 'Tamaño máximo del archivo es {filesize}',
                         labelMaxTotalFileSizeExceeded: 'Tamaño total máximo de archivos excedido',
                         labelMaxTotalFileSize: 'Tamaño total máximo de archivos es {filesize}',
                         labelFileTypeNotAllowed: 'Tipo de archivo no permitido',
                         fileValidateTypeLabelExpectedTypes: 'Espera {allButLastType} o {lastType}',
                         imageValidateSizeLabelFormatError: 'Tipo de imagen no compatible',
                         imageValidateSizeLabelImageSizeTooSmall: 'La imagen es demasiado pequeña',
                         imageValidateSizeLabelImageSizeTooBig: 'La imagen es demasiado grande',
                         imageValidateSizeLabelExpectedMinSize: 'Tamaño mínimo de imagen es {minWidth} × {minHeight}',
                         imageValidateSizeLabelExpectedMaxSize: 'Tamaño máximo de imagen es {maxWidth} × {maxHeight}',
                         imageValidateSizeLabelImageResolutionTooLow: 'Resolución demasiado baja',
                         imageValidateSizeLabelImageResolutionTooHigh: 'Resolución demasiado alta',
                         imageValidateSizeLabelExpectedMinResolution: 'Resolución mínima de imagen es {minResolution}',
                         imageValidateSizeLabelExpectedMaxResolution: 'Resolución máxima de imagen es {maxResolution}',     
                         dropValidation: true,
                         acceptedFileTypes:["application/pdf"],
                         fileValidateTypeDetectType: (source, type) =>
                             new Promise((resolve, reject) => {
                                 // Do custom type detection here and return with promise
                                 resolve(type);
                         }),
                         server:{
                           process: (fieldName, file, metadata, load, error, progress, abort) => {
                              // Custom ajax file upload or local storing here
                              //#formImportFile
                              let sql_data= "";
                              const formData = new FormData($("#formImportFile")[0]);
                              formData.set('sql_data', sql_data);
                              formData.set('fileExcel', file);
                              formData.set('country', $('#select-country').val());
                              $('#btn-fail-data').prop('disabled', true);
                              $('#btn-done-data').prop('disabled', true);
                              $('#btn-upload-data').prop('disabled', true);
                              $.ajax({
                                   url: "@Url.Action("LoadData", "PrototipoFlow")/",
                                   data: formData,
                                   method: 'POST',
                                   dataType: 'json',
                                   cache: false,
                                   contentType: false,
                                   processData: false,
                                   beforeSend: function() {
                                       $('.detail-records-resumen ul').html('');
                                   } 
                              }).done((response)=>{
                                  console.log(response);
                                  $('.detail-records-resumen ul').append(`
                                      <li class="list-group-item">
                                          <i class="fe fe-check-circle text-primary me-1 fs-13 d-inline-flex"></i> <span class="badge bg-info">${response.number_of_correct_records}</span> registros son validos</span>  
                                      </li>
                                      <li class="list-group-item">
                                          <i class="fe fe-info text-secondary me-1 fs-13 d-inline-flex"></i> <span class="badge bg-info">${response.number_of_incorrect_records}</span> registros son invalidos</span>  
                                      </li>
                                  `);
                                  $('#btn-fail-data').prop('disabled', false);
                                  $('#btn-done-data').prop('disabled', false);
                                  if (response.number_of_incorrect_records==0)
                                      $('#btn-upload-data').prop('disabled', false);
                                  $("#modalShowData").data('jsonData', response);
                                  progress(true, 0, 1024);
                                  load('unique-file-id');
                              }).fail((response) => {
                                  error('Error occurred');
                                  $("#modalShowData").data('jsonData', {});
                                  console.log(response.status);
                                  if (response.status == 511){
                                      location.reload();
                                  }
                                  if (response.status == 403){
                                      window.location.href = '/Error';
                                  }
                                  //console.error(error.statusCode());
                                  Swal.fire(
                                      'Información!',
                                      response.responseText,
                                      'error'
                                  );
                              });
                          
                              return {
                                abort: function() {
                                  abort();
                                }
                              };
                           }
                         },
                         onremovefile: function(fileItem) {
                             // Ejecutar tu función aquí
                             $('.detail-records-resumen ul').html('');
                             $('#btn-fail-data').prop('disabled', true);
                             $('#btn-done-data').prop('disabled', true);
                             $('#btn-upload-data').prop('disabled', true);
                             $("#modalShowData").data('jsonData', {});
                         }
                       });
         $('#btn-show-modal-upload').click(function (){
             let pais = $('#select-country').val();
             //myfilepond.filepond();
             $('.filepond--file-action-button').trigger('click')
             $('[name="fileExcel"]').val('');
             $('#formImportFile')[0].reset();
             $('.detail-records-resumen ul').html('');
             $('#btn-fail-data').prop('disabled', true);
             $('#btn-done-data').prop('disabled', true);
             $('#btn-upload-data').prop('disabled', true);
             $("#modalShowData").data('jsonData', {});
             $('#modalImportFile').modal('show');
         });
         
           $("#btn-fail-data").click(function() {
             let jsonData  = $("#modalShowData").data('jsonData');
             cargarDetalleDatos(jsonData.incorrect_records);
             $('#modalShowData').modal("show");
           });
           
           $("#btn-done-data").click(function() {
              let jsonData  = $("#modalShowData").data('jsonData');
              cargarDetalleDatos(jsonData.correct_records)
              $('#modalShowData').modal("show");
           });
    </script>
}